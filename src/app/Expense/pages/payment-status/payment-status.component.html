<div class="advance-container">
    <div *ngIf="showContent">
        <div *ngIf="showPendingEmployees" class="pending-employees-section">
            <h2>Payment status</h2>

            <!-- <div class="header-actions">
                <div class="filter-container">
                    <select (change)="filterAdvances()" (click)="$event.stopPropagation()" [(ngModel)]="filterStatus">
                        <option value="all">All Requests</option>
                        <option value="pending">Pending</option>
                        <option value="approved">Approved</option>
                        <option value="rejected">Rejected</option>
                    </select>
                    <input type="text" [(ngModel)]="searchEmployeeName" (input)="filterAdvances()"
                        placeholder="Search Pending Employee" />
                    <button class="add-advance-btn" (click)="toggleForm()">+ Add New Advance</button>
                </div>
            </div> -->
            <h3>Employees Advances Status</h3>
            <!-- <div class="employee-cards">
                <div *ngFor="let employee of approvedExpenses" class="employee-card">
                    <div class="employee-id-container">
                        <div class="employee-id">
                            {{ getEmployeeInfo(employee)?.employeeName }} ({{ getEmployeeInfo(employee)?.empId }})
                        </div>
                    </div>
                    <button (click)="showEmployeePending(employee)" class="view-details-button">
                        <i class="fas fa-eye"></i> View Details
                    </button>
                </div>
            </div> -->
            <div class="overall-approvals-list">
                <div class="overall-list-header">
                    <span class="overall-list-field">Name</span>
                    <span class="overall-list-field">Employee ID</span>
                    <span class="overall-list-field">Payment Status</span>
                </div>
            </div>
            <div class="overall-approvals-list" style="background: white; flex-direction: column;">

                <div *ngFor="let employee of approvedExpenses" class="overall-values-header"
                    (click)="showEmployeePending(employee)">
                    <div class="overall-list-field" style="color: black;">{{ getEmployeeInfo(employee)?.employeeName }}
                    </div>
                    <div class="overall-list-field" style="color: black;">{{ getEmployeeInfo(employee)?.empId
                        }}</div>
                    <div class="progress-container">
                        <div class="progress-track">
                            <div class="progress-fill" [ngStyle]="{ width: getProgressWidth() }"></div>
                            <div class="step-dot" *ngFor="let step of steps; let i = index"
                                [class.active]="i < currentStep">

                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <button (click)="showAllAdvances()" class="view-all-expenses-button">
                <i class="fas fa-list"></i> View All Advances
            </button>
        </div>

        <div *ngIf="!showPendingEmployees" class="table-container">
            <h2>Advances</h2>
            <div *ngIf="isViewAllAdvances" class="header-actions">
                <div class="filter-container">
                    <select (change)="filterAdvances()" (click)="$event.stopPropagation()" [(ngModel)]="filterStatus">
                        <option value="all">All Requests</option>
                        <option value="pending">Pending</option>
                        <option value="approved">Approved</option>
                        <option value="rejected">Rejected</option>
                    </select>
                    <input type="text" [(ngModel)]="searchEmployeeName" (input)="filterAdvances()"
                        placeholder="Search Employee Name" />
                    <button class="add-advance-btn" (click)="toggleForm()">+ Add New Advance</button>
                </div>
            </div>
            <div class="list-header">
                <div class="header-empid">Empid</div>
                <div class="header-name">Name</div>
                <div class="header-date">Date</div>
                <div class="header-amount">Amount</div>
                <div class="header-merchant">Category/Description</div>
                <div class="headesr-status">Status</div>
                <div class="col-file">RejectReason</div>
                <div class="header-actions">Actions</div>
            </div>

            <div *ngFor="let advance of pagedAdvances" class="advance-item">
                <div class="item-empid">
                    <span class="empid">{{ advance.empId }}</span>
                </div>
                <div class="item-employeename">
                    <span class="name">{{ advance.employeeName }}</span>
                </div>
                <div class="item-date">
                    {{ advance.advanceDate | date: 'mediumDate' }}
                </div>
                <div class="item-amount">
                    {{ advance.amount | number: '1.2-2' }}
                </div>
                <div class="item-details">
                    <span class="category">{{ advance.paidThrough }}</span>
                    <span class="description">{{ advance.applyToTrip }}</span>
                </div>
                <div class="item-status">
                    <span class="status-badge" [ngClass]="getStatusClass(advance.status)">
                        {{ advance.status | titlecase }}
                    </span>
                </div>
                <div class="col-file">{{ advance.rejectreason || 'N/A' }}</div>
                <div class="item-actions">
                    <button class="btn-icon" (click)="onEdit(advance)" title="Edit">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-icon" (click)="onDelete(advances.indexOf(advance))" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>

            <div *ngIf="advances.length === 0" class="no-requests">
                <i class="fas fa-receipt fa-3x"></i>
                <p>No advance requests added yet.</p>
            </div>
            <div class="pagination-controls">
                <button class="arrow-button" (click)="previousPage()" [disabled]="currentPage === 1">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <span class="page-number">{{ currentPage }} / {{ totalPages }}</span>
                <button class="arrow-button" (click)="nextPage()"
                    [disabled]="currentPage * itemsPerPage >= filteredAdvances.length">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <div *ngIf="currentPage === 1" class="pagination-info">
                Total Records: {{ totalRecords }}, Total Pages: {{ totalPages }}
            </div>

            <button (click)="goBack()" class="back-button">
                <i class="fas fa-arrow-left"></i> Back
            </button>
        </div>
    </div>

    <div class="overlay" *ngIf="showForm">
        <div class="popup-box">
            <h3>{{ editingIndex !== undefined ? 'Edit' : 'Add' }} Advance Request</h3>
            <form #advanceForm="ngForm" (ngSubmit)="submitAdvance(advanceForm)">
                <div class="form-group">
                    <label for="advanceDate">Date:</label>
                    <input id="advanceDate" type="date" [(ngModel)]="newAdvance.advanceDate" name="advanceDate"
                        required />
                </div>

                <div class="form-group">
                    <label for="amount">Amount:</label>
                    <input id="amount" type="number" [(ngModel)]="newAdvance.amount" name="amount" required />
                </div>

                <div class="form-group">
                    <label for="paidThrough">Paid Through:</label>
                    <select id="paidThrough" (click)="$event.stopPropagation()" [(ngModel)]="newAdvance.paidThrough"
                        name="paidThrough" required>
                        <option value="" disabled selected>Select Payment Method</option>
                        <option value="Cash">Cash</option>
                        <option value="Bank Transfer">Bank Transfer</option>
                        <option value="Credit Card">Credit Card</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="applyToTrip">Apply to Trip:</label>
                    <input id="applyToTrip" type="text" [(ngModel)]="newAdvance.applyToTrip" name="applyToTrip"
                        placeholder="Trip ID or Details (optional)" />
                </div>
                <div class="buttons">
                    <button type="submit" class="submit-btn" [disabled]="!advanceForm.valid">
                        {{ editingIndex !== undefined ? 'Update' : 'Submit' }}
                    </button>
                    <button type="button" class="cancel-btn" (click)="toggleForm()">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>