<div class="advance-container">
    <div *ngIf="showContent">
        <div *ngIf="showPendingEmployees" class="header-content">
            <h2>Advances</h2>
            <div *ngIf="isViewAllAdvances" class="header-controls">
                <div class="filter-container">
                    <select (change)="filterAdvances()" (click)="$event.stopPropagation()" [(ngModel)]="filterStatus">
                        <option value="all">All Requests</option>
                        <option value="pending">Pending</option>
                        <option value="Payment To Be Initiate">Payment To Be Initiate</option>
                        <option value="Payment Initiated">Payment Initiated</option>
                        <option value="Payment Done">Payment Done</option>
                        <option value="rejected">Rejected</option>
                    </select>
                    <!-- <input type="text" [(ngModel)]="searchEmployeeName" (input)="filterAdvances()"
                        placeholder="Search Employee Name" /> -->
                    <button class="add-advance-btn" (click)="toggleForm()">+ Add New Advance</button>
                </div>
            </div>
            </div>
            <div class="list-header">
                <div class="header-empid">Empid</div>
                <div class="header-name">Name</div>
                <div class="header-date">Date</div>
                <div class="header-amount">Amount</div>
                <div class="header-merchant">Category/Description</div>
                <div class="headesr-status">Status</div>
                <div class="col-file">Reason</div>
                <div class="header-actions">Actions</div>
            </div>

            <div *ngFor="let advance of pagedAdvances" class="advance-item">
                <div class="item-empid">
                    <span class="empid">{{ advance.empId }}</span>
                </div>
                <div class="item-employeename">
                    <span class="name">{{ advance.employeeName }}</span>
                </div>
                <div class="item-date">
                    {{ advance.advanceDate | date: 'mediumDate' }}
                </div>
                <div class="item-amount">
                    {{ advance.amount | number: '1.2-2' }}
                </div>
                <div class="item-details">
                    <span class="category">{{ advance.paidThrough }}</span>
                    <span class="description">{{ advance.applyToTrip }}</span>
                </div>
                <div class="item-status">
                    <span class="status-badge" [ngClass]="getStatusClass(advance.status)">
                        {{ advance.status | titlecase }}
                    </span>
                </div>
                <div class="col-file">{{ advance.rejectreason || 'N/A' }}</div>
                <div class="item-actions">
                    <button *ngIf="advance.status !== 'Pending'" class="btn-icon" (click)="viewExpense(advance)" title="View">
                        <i class="fas fa-eye"></i>
                      </button>
                    <button *ngIf="advance.status === 'Pending'" class="btn-icon" (click)="onEdit(advance)" title="Edit">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button  *ngIf="advance.status === 'Pending'" class="btn-icon" (click)="onDeleteAdvance(advances.indexOf(advance))" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>

            <div *ngIf="advances.length === 0" class="no-requests">
                <i class="fas fa-receipt fa-3x"></i>
                <p>No advance requests added yet.</p>
            </div>
            <div class="pagination-controls">
                <button class="arrow-button" (click)="previousPage()" [disabled]="currentPage === 1">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <span class="page-number">{{ currentPage }} / {{ totalPages }}</span>
                <button class="arrow-button" (click)="nextPage()"
                    [disabled]="currentPage * itemsPerPage >= filteredAdvances.length">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <div *ngIf="currentPage === 1" class="pagination-info">
                Total Records: {{ totalRecords }}, Total Pages: {{ totalPages }}
            </div>

            <!-- <button (click)="goBack()" class="back-button">
                <i class="fas fa-arrow-left"></i> Back
            </button> -->
    </div>

    <div class="overlay" *ngIf="showForm">
        <div class="popup-box">
            <h3>{{headerText}}</h3>
            <form #advanceForm="ngForm" (ngSubmit)="submitAdvance(advanceForm)">
                <div class="form-group">
                    <label for="advanceDate">Date:</label>
                    <input id="advanceDate" type="date" [(ngModel)]="newAdvance.advanceDate" name="advanceDate"
                        required [disabled]="!showbtn" [min]="minDate"/>
                </div>

                <div class="form-group">
                    <label for="amount">Amount:</label>
                    <input id="amount" type="number" [(ngModel)]="newAdvance.amount" name="amount" required [disabled]="!showbtn" />
                </div>

                <div class="form-group">
                    <label for="paidThrough">Paid Through:</label>
                    <select id="paidThrough" (click)="$event.stopPropagation()"
                        [(ngModel)]="newAdvance.paidThrough" name="paidThrough" required [disabled]="!showbtn">
                        <!-- <option value="" disabled selected>Select Payment Method</option>
                        <option value="Cash">Cash</option> -->
                        <option value="Bank Transfer" selected>Bank Transfer</option>
                        <!-- <option value="Credit Card">Credit Card</option> -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="applyToTrip">Purpose:</label>
                    <input id="applyToTrip" type="text" [(ngModel)]="newAdvance.applyToTrip" name="applyToTrip"
                        placeholder="Trip ID or Details (optional)" [disabled]="!showbtn"/>
                </div>
                <div class="buttons">
                    <button *ngIf="showbtn;" type="submit" class="submit-btn" [disabled]="!advanceForm.valid">
                        {{ editingIndex !== undefined ? 'Update' : 'Submit' }}
                    </button>
                    <button type="button" class="cancel-btn" (click)="toggleForm()">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>