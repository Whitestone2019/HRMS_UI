<div class="main">
  <div class="profile-card">
    <!-- Profile Picture - Dynamic based on uploaded photo or default -->
    <div class="profile-picture-container">
      <!-- Show loading spinner while fetching -->
      <div *ngIf="isProfilePictureLoading" class="profile-picture-loading">
        <div class="spinner"></div>
      </div>
      
      <!-- Show profile picture when loaded -->
      <img 
        *ngIf="!isProfilePictureLoading"
        alt="Profile Picture" 
        height="80" 
        [src]="profilePicture" 
        width="80"
        (error)="onProfilePictureError()"
        class="profile-picture"
      />
    </div>
    
    <h2>{{ employeeId }}</h2>
    <h2>{{ username }}</h2>
    <h6>{{ userRole }}</h6>
    <h2>Reporting To</h2>
    <h6>{{ managerId }} - {{ managerName }}</h6>
    <div class="status" [ngClass]="{ 'in': employeeStatus === 'In', 'out': employeeStatus === 'Out' }">{{ employeeStatus }}</div>
    <div class="timer">{{ timerDisplay }}</div>
    <div class="button-group">
      <button *ngIf="employeeStatus === 'Out'" (click)="checkIn()" class="checkin-btn">Check-in</button>
      <button *ngIf="employeeStatus === 'In'" (click)="checkOut()" class="checkout-btn">Check-out</button>

      <!-- Button is ALWAYS VISIBLE (removed *ngIf="!hasUploaded") -->
      <button (click)="openIdCardDialog()" class="idcard-btn">
        Upload ID Card Photo
      </button>

      <button (click)="PersonalDetails()" class="idcard-btn">
        Personal Details
      </button>
    </div>
  </div>
  
  <div class="content">
    <!-- Other Employees Celebrations Notification Card - UPDATED FOR GROUPED CELEBRATIONS -->
    <div *ngIf="showOtherCelebrations && groupedOtherCelebrations.length > 0" class="celebration-notification-card">
      <div class="celebration-notification-header">
        <h3>ğŸ‰ Today's Celebrations</h3>
        <button class="close-btn" (click)="hideOtherCelebrations()">Ã—</button>
      </div>
      <div class="celebration-notification-content">
        <!-- Grouped celebrations display -->
        <div *ngFor="let group of groupedOtherCelebrations" class="celebration-group">
          <div class="celebration-group-header">
            <div class="celebration-group-icon" [ngClass]="{'birthday-icon': group.type === 'birthday', 'anniversary-icon': group.type === 'anniversary'}">
              {{ group.type === 'birthday' ? 'ğŸ‚' : 'ğŸ¢' }}
              <span class="celebration-count">({{ group.count }})</span>
            </div>
            <div class="celebration-group-title" [ngClass]="{'birthday-title': group.type === 'birthday', 'anniversary-title': group.type === 'anniversary'}">
              {{ group.title }}
            </div>
          </div>
          
          <div class="celebration-group-names">
            <span class="grouped-usernames">
              {{ formatNameList(group.usernames) }}
            </span>
            <span *ngIf="group.type === 'anniversary' && group.yearsArray.length > 0" class="group-years">
              ({{ group.yearsArray.join(', ') }} {{ group.yearsArray.length === 1 ? 'year' : 'years' }})
            </span>
          </div>
          
          <div class="celebration-group-message">
            {{ group.message }}
          </div>
          
          <div class="celebration-group-action">
            Let's wish them today! ğŸ‰
          </div>
        </div>
      </div>
    </div>

    <div class="greeting">
      <img alt="Greeting Image" height="50" src="https://storage.googleapis.com/a1aa/image/J4oA29iMvR5iEd3wnSSLboIKIETtV1GY5r51w13ew1ayvG3JA.jpg" width="50"/>
      <div class="text">
        <h2>Good Morning {{ username }}</h2>
        <p>Have a productive day!</p>
      </div>
      <div class="quote">
        "Success is liking yourself, liking what you do, and liking how you do it." - Maya Angelou
      </div>
    </div>
    
    <div class="menu-content">
      <app-attendance-pie-chart
        [label]="yesterday_label"
        [present]="yesterday_present"
        [absent]="yesterday_absent"
        [day]="yesterday_day">
      </app-attendance-pie-chart>

      <app-attendance-pie-chart
        [label]="today_label"
        [present]="today_present"
        [absent]="today_absent"
        [day]="today_day">
      </app-attendance-pie-chart>

      <app-team-attendance-breakdown-pie
        *ngIf="!isLoadingSummary && isAdmin"
        [attendancePercentage]="overallSummary.attendancePercentage"
        [totalPresent]="overallSummary.totalPresent"
        [leaveWithPay]="overallSummary.leaveWithPay"
        [leaveWithoutPay]="overallSummary.leaveWithoutPay"
        [unplannedLeave]="overallSummary.unplannedLeave"
        [period]="overallSummary.period">
      </app-team-attendance-breakdown-pie>

      <div class="loading-card" *ngIf="isLoadingSummary && isAdmin">
        <p>Loading team attendance breakdown...</p>
      </div>
    </div>
  </div>
</div>

<!-- Celebration Modal (Full Screen) - UPDATED FOR MULTIPLE CELEBRATIONS -->
<div *ngIf="showCelebrationModal && currentCelebration" class="celebration-modal-fullscreen">
  <!-- Full-screen GIF background -->
  <div class="gif-background">
    <img [src]="currentCelebration.type === 'birthday' ? birthdayGifUrl : anniversaryGifUrl" 
         alt="Celebration Animation" 
         class="gif-image">
  </div>
  
  <!-- Celebration Content -->
  <div class="celebration-content">
    <!-- Celebration counter (only show if multiple celebrations) -->
    <div *ngIf="celebrationTypes.length > 1" class="celebration-counter">
      Celebration {{ currentCelebrationIndex + 1 }} of {{ celebrationTypes.length }}
    </div>
    
    <!-- Celebration Title with separate colors -->
    <div class="celebration-title-section">
      <h2 class="celebration-title-text" [ngClass]="{'birthday-title': currentCelebration.type === 'birthday', 'anniversary-title': currentCelebration.type === 'anniversary'}">
        {{ currentCelebration.title }}
      </h2>
      <h2 class="celebration-username-text">
        {{ currentCelebration.username }}!
      </h2>
      <h3 class="celebration-message-text" *ngIf="currentCelebration.message">
        {{ currentCelebration.message }}
      </h3>
    </div>
    
    <!-- Birthday Celebration Content -->
    <div *ngIf="currentCelebration.type === 'birthday'" class="celebration-details">
      <!-- <p>ğŸ‰ Wishing you a day filled with happiness and joy! ğŸ‰</p> -->
      <p>May all your dreams and wishes come true!</p>
      <div class="years-badge" *ngIf="currentCelebration.years > 0">
        {{ currentCelebration.years }} {{ currentCelebration.years === 1 ? 'Year' : 'Years' }} Old
      </div>
    </div>
    
    <!-- Anniversary Celebration Content -->
    <div *ngIf="currentCelebration.type === 'anniversary'" class="celebration-details">
      <p>ğŸ¯ Celebrating Excellence & Dedication! ğŸ¯</p>
  <p>Your commitment continues to inspire us all. Keep shining!</p>
      <div class="years-badge">
        {{ currentCelebration.years }} {{ currentCelebration.years === 1 ? 'Year' : 'Years' }}
      </div>
    </div>
    
    <!-- Combined celebrations preview (only show if multiple) -->
    <div *ngIf="celebrationTypes.length > 1" class="combined-celebrations-preview">
      <div class="preview-title">ğŸ‰ All Your Celebrations Today:</div>
      <div class="preview-items">
        <div *ngFor="let celebration of celebrationTypes; let i = index" 
             class="preview-item"
             [ngClass]="{'active': i === currentCelebrationIndex}">
          <span class="preview-icon">
            {{ celebration === 'birthday' ? 'ğŸ‚' : 'ğŸ¢' }}
          </span>
          <span class="preview-text">
            {{ celebration === 'birthday' ? 'Birthday' : 'Anniversary' }}
          </span>
        </div>
      </div>
    </div>
    
    <!-- Close button -->
    <!-- <button class="close-celebration-btn" (click)="closeCelebrationModal()">
      ğŸ‰ Continue Celebrating! ğŸ‰
    </button> -->
  </div>
</div>