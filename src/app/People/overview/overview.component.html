<div class="main">
  <div class="profile-card">
    <!-- Profile Picture - Dynamic based on uploaded photo or default -->
    <div class="profile-picture-container">
      <!-- Show loading spinner while fetching -->
      <div *ngIf="isProfilePictureLoading" class="profile-picture-loading">
        <div class="spinner"></div>
      </div>
      
      <!-- Show profile picture when loaded -->
      <img 
        *ngIf="!isProfilePictureLoading"
        alt="Profile Picture" 
        height="80" 
        [src]="profilePicture" 
        width="80"
        (error)="onProfilePictureError()"
        class="profile-picture"
      />
    </div>
    
    <h2>{{ employeeId }}</h2>
    <h2>{{ username }}</h2>
    <h6>{{ userRole }}</h6>
    <h2>Reporting To</h2>
    <h6>{{ managerId }} - {{ managerName }}</h6>
    <div class="status" [ngClass]="{ 'in': employeeStatus === 'In', 'out': employeeStatus === 'Out' }">{{ employeeStatus }}</div>
    <div class="timer">{{ timerDisplay }}</div>
    <div class="button-group">
      <button *ngIf="employeeStatus === 'Out'" (click)="checkIn()" class="checkin-btn">Check-in</button>
      <button *ngIf="employeeStatus === 'In'" (click)="checkOut()" class="checkout-btn">Check-out</button>
      <button (click)="openIdCardDialog()" class="idcard-btn">Upload ID Card Photo</button>
      <button (click)="PersonalDetails()" class="idcard-btn">Personal Details</button>
    </div>
  </div>
  
  <div class="content">
    <!-- ============================================ -->
    <!-- DIVIDED CELEBRATION CARD - 2 COLUMN LAYOUT   -->
    <!-- ============================================ -->
    <div *ngIf="showOtherCelebrations && groupedOtherCelebrations.length > 0" class="celebration-notification-card">
      <div class="celebration-notification-header">
        <h3>ğŸ‰ Today's Celebrations</h3>
        <button class="close-btn" (click)="hideOtherCelebrations()">Ã—</button>
      </div>
      
      <div class="celebration-notification-content">
        <!-- DIVIDED INTO 2 COLUMNS - BIRTHDAY LEFT, ANNIVERSARY RIGHT -->
        <div class="celebrations-split-container">
          
          <!-- LEFT COLUMN - BIRTHDAYS -->
          <div class="celebration-column birthday-column" *ngIf="getBirthdayGroup() as birthdayGroup">
            <div class="column-header birthday-header">
              <span class="column-icon">ğŸ‚</span>
              <span class="column-title">Birthday</span>
              <span class="column-count" *ngIf="birthdayGroup.count > 0">({{ birthdayGroup.count }})</span>
            </div>
            
            <div *ngIf="birthdayGroup.count > 0" class="column-content">
              <div class="celebration-group-names">
                <span class="grouped-usernames birthday-names">
                  {{ formatNameList(birthdayGroup.usernames) }}
                </span>
              </div>
              
              <div class="celebration-group-message birthday-message">
                {{ birthdayGroup.message }}
              </div>
              
              <div class="celebration-group-action">
                <button class="wish-group-button birthday-wish-btn" 
                        (click)="sendGroupWish(birthdayGroup)" 
                        [disabled]="birthdayGroup.isSending">
                  <span *ngIf="!birthdayGroup.isSending">
                    <i class="fas fa-gift"></i> Send Wish ({{ birthdayGroup.count }})
                  </span>
                  <span *ngIf="birthdayGroup.isSending">
                    <i class="fas fa-spinner fa-spin"></i> Sending {{ birthdayGroup.successCount }}/{{ birthdayGroup.count }}...
                  </span>
                </button>
                
                <div *ngIf="birthdayGroup.wishSent" class="wish-sent-confirmation birthday-success">
                  âœ… {{ birthdayGroup.wishSuccessMessage || 'Wish sent successfully!' }}
                </div>
                
                <div *ngIf="birthdayGroup.wishError" class="wish-error birthday-error">
                  âŒ {{ birthdayGroup.wishError }}
                </div>
              </div>
            </div>
            
            <div *ngIf="birthdayGroup.count === 0" class="no-celebrations">
              <span class="no-celebration-text">No birthdays today</span>
            </div>
          </div>
          
          <!-- RIGHT COLUMN - ANNIVERSARIES -->
          <div class="celebration-column anniversary-column" *ngIf="getAnniversaryGroup() as anniversaryGroup">
            <div class="column-header anniversary-header">
              <span class="column-icon">ğŸ¢</span>
              <span class="column-title">Anniversary</span>
              <span class="column-count" *ngIf="anniversaryGroup.count > 0">({{ anniversaryGroup.count }})</span>
            </div>
            
            <div *ngIf="anniversaryGroup.count > 0" class="column-content">
              <div class="celebration-group-names">
                <span class="grouped-usernames anniversary-names">
                  {{ formatNameList(anniversaryGroup.usernames) }}
                </span>
                <span *ngIf="anniversaryGroup.yearsArray.length > 0" class="group-years anniversary-years">
                  ({{ anniversaryGroup.yearsArray.join(', ') }} {{ anniversaryGroup.yearsArray.length === 1 ? 'year' : 'years' }})
                </span>
              </div>
              
              <div class="celebration-group-message anniversary-message">
                {{ anniversaryGroup.message }}
              </div>
              
              <div class="celebration-group-action">
                <button class="wish-group-button anniversary-wish-btn" 
                        (click)="sendGroupWish(anniversaryGroup)" 
                        [disabled]="anniversaryGroup.isSending">
                  <span *ngIf="!anniversaryGroup.isSending">
                    <i class="fas fa-gift"></i> Send Wish ({{ anniversaryGroup.count }})
                  </span>
                  <span *ngIf="anniversaryGroup.isSending">
                    <i class="fas fa-spinner fa-spin"></i> Sending {{ anniversaryGroup.successCount }}/{{ anniversaryGroup.count }}...
                  </span>
                </button>
                
                <div *ngIf="anniversaryGroup.wishSent" class="wish-sent-confirmation anniversary-success">
                  âœ… {{ anniversaryGroup.wishSuccessMessage || 'Wish sent successfully!' }}
                </div>
                
                <div *ngIf="anniversaryGroup.wishError" class="wish-error anniversary-error">
                  âŒ {{ anniversaryGroup.wishError }}
                </div>
              </div>
            </div>
            
            <div *ngIf="anniversaryGroup.count === 0" class="no-celebrations">
              <span class="no-celebration-text">No anniversaries today</span>
            </div>
          </div>
          
        </div>
      </div>
    </div>

    <div class="greeting">
      <img alt="Greeting Image" height="50" src="https://storage.googleapis.com/a1aa/image/J4oA29iMvR5iEd3wnSSLboIKIETtV1GY5r51w13ew1ayvG3JA.jpg" width="50"/>
      <div class="text">
        <h2>Good {{ getGreeting() }} {{ username }}</h2>
        <p>Have a productive day!</p>
      </div>
      <div class="quote">
        "Success is liking yourself, liking what you do, and liking how you do it." - Maya Angelou
      </div>
    </div>
    
    <div class="menu-content">
      <app-attendance-pie-chart
        [label]="yesterday_label"
        [present]="yesterday_present"
        [absent]="yesterday_absent"
        [day]="yesterday_day">
      </app-attendance-pie-chart>

      <app-attendance-pie-chart
        [label]="today_label"
        [present]="today_present"
        [absent]="today_absent"
        [day]="today_day">
      </app-attendance-pie-chart>

      <app-team-attendance-breakdown-pie
        *ngIf="!isLoadingSummary && isAdmin"
        [attendancePercentage]="overallSummary.attendancePercentage"
        [totalPresent]="overallSummary.totalPresent"
        [leaveWithPay]="overallSummary.leaveWithPay"
        [leaveWithoutPay]="overallSummary.leaveWithoutPay"
        [unplannedLeave]="overallSummary.unplannedLeave"
        [period]="overallSummary.period">
      </app-team-attendance-breakdown-pie>

      <div class="loading-card" *ngIf="isLoadingSummary && isAdmin">
        <p>Loading team attendance breakdown...</p>
      </div>
    </div>
  </div>
</div>

<!-- Celebration Modal (Full Screen) -->
<div *ngIf="showCelebrationModal && currentCelebration" class="celebration-modal-fullscreen">
  <!-- Full-screen GIF background -->
  <div class="gif-background">
    <img [src]="currentCelebration.type === 'birthday' ? birthdayGifUrl : anniversaryGifUrl" 
         alt="Celebration Animation" 
         class="gif-image">
  </div>
  
  <!-- Celebration Content -->
  <div class="celebration-content">
    <!-- Celebration counter (only show if multiple celebrations) -->
    <div *ngIf="celebrationTypes.length > 1" class="celebration-counter">
      Celebration {{ currentCelebrationIndex + 1 }} of {{ celebrationTypes.length }}
    </div>
    
    <!-- Celebration Title with separate colors -->
    <div class="celebration-title-section">
      <h2 class="celebration-title-text" [ngClass]="{'birthday-title': currentCelebration.type === 'birthday', 'anniversary-title': currentCelebration.type === 'anniversary'}">
        {{ currentCelebration.title }}
      </h2>
      <h2 class="celebration-username-text">
        {{ currentCelebration.username }}!
      </h2>
      <h3 class="celebration-message-text" *ngIf="currentCelebration.message">
        {{ currentCelebration.message }}
      </h3>
    </div>
    
    <!-- Birthday Celebration Content -->
    <div *ngIf="currentCelebration.type === 'birthday'" class="celebration-details">
      <p>May all your dreams and wishes come true!</p>
      <div class="years-badge" *ngIf="currentCelebration.years > 0">
        {{ currentCelebration.years }} {{ currentCelebration.years === 1 ? 'Year' : 'Years' }} Old
      </div>
    </div>
    
    <!-- Anniversary Celebration Content -->
    <div *ngIf="currentCelebration.type === 'anniversary'" class="celebration-details">
      <p>ğŸ¯ Celebrating Excellence & Dedication! ğŸ¯</p>
      <p>Your commitment continues to inspire us all. Keep shining!</p>
      <div class="years-badge">
        {{ currentCelebration.years }} {{ currentCelebration.years === 1 ? 'Year' : 'Years' }}
      </div>
    </div>
    
    <!-- Combined celebrations preview (only show if multiple) -->
    <div *ngIf="celebrationTypes.length > 1" class="combined-celebrations-preview">
      <div class="preview-title">ğŸ‰ All Your Celebrations Today:</div>
      <div class="preview-items">
        <div *ngFor="let celebration of celebrationTypes; let i = index" 
             class="preview-item"
             [ngClass]="{'active': i === currentCelebrationIndex}">
          <span class="preview-icon">
            {{ celebration === 'birthday' ? 'ğŸ‚' : 'ğŸ¢' }}
          </span>
          <span class="preview-text">
            {{ celebration === 'birthday' ? 'Birthday' : 'Anniversary' }}
          </span>
        </div>
      </div>
    </div>
  </div>
</div>