<div class="report-page">

  <!-- MAIN REPORT -->
  <div class="report-container" *ngIf="!showSingleReport">
    <h1 class="page-title">Monthly Timesheet Report (27th - 26th Cycle)</h1>

    <div class="filters-row">
      <div class="filter-group">
        <label>Select Payroll Month</label>
        <select (click)="$event.stopPropagation()" [(ngModel)]="selectedPayrollMonth" (change)="onPayrollMonthChange()" class="form-control">
          <option *ngFor="let m of payrollMonths" [value]="m.value">
            {{ m.label }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label>Search Employee</label>
        <input type="text" [(ngModel)]="searchTerm" (input)="applyFilter()"
               placeholder="Emp ID or Name" class="form-control search-input">
      </div>

      <div class="filter-group">
        <label>Rows per page</label>
        <select  (click)="$event.stopPropagation()" [(ngModel)]="pageSize" (change)="resetPagination()" class="form-control">
          <option value="10">10</option>
          <option value="25">25</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select>
      </div>
    </div>

    <div class="loading" *ngIf="loading">Loading timesheet data...</div>

    <div class="table-responsive" *ngIf="!loading">
      <table class="report-table" *ngIf="paginatedEmployees.length > 0">
        <thead>
          <tr>
            <th>S.No</th>
            <th>Emp ID</th>
            <th>Name</th>
            <th>Effective Days</th>
            <th>Present</th>
            <th>Half Day</th>
            <th>Absent</th>
            <th>Miss Punch</th>
            <th>OD</th>
            <th>Comp Off</th>
            <th>Holidays</th>
            <th>Weekoffs</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let emp of paginatedEmployees; let i = index">
            <td>{{ getSerialNumber(i) }}</td>
            <td>{{ emp.employeeId }}</td>
            <td class="text-left">{{ emp.members }}</td>
            <td>{{ emp.effectiveWorkingDays }}</td>
            <td>{{ emp.present | number:'1.1-1' }}</td>
            <td><strong class="half-day">{{ emp.halfDay || 0 }}</strong></td>
            <td>{{ emp.absent }}</td>
            <td>{{ emp.missPunch }}</td>
            <td>{{ emp.od }}</td>
            <td>{{ emp.compoff }}</td>
            <td>{{ emp.holiday }}</td>
            <td>{{ emp.weekoff }}</td>
          </tr>
        </tbody>
      </table>

      <div class="no-data" *ngIf="!loading && filteredEmployees.length === 0">
        <p>No employees found for the selected payroll month.</p>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination-controls" *ngIf="filteredEmployees.length > 0">
      <button (click)="prevPage()" [disabled]="currentPage === 1">Previous</button>
      <span>Page {{ currentPage }} of {{ totalPages() }}</span>
      <button (click)="nextPage()" [disabled]="currentPage === totalPages()">Next</button>
      <span class="total">Total: {{ filteredEmployees.length }} records</span>
    </div>

    <!-- Download Button -->
    <div class="actions">
      <button class="btn-download" (click)="downloadReport()" 
              [disabled]="loading || employees.length === 0">
        Download Excel Report
      </button>
    </div>
  </div>

  <!-- SINGLE EMPLOYEE VIEW -->
  <div class="single-report" *ngIf="showSingleReport">
    <button class="btn-back" (click)="backToMainPage()">Back</button>
    <h2>Detailed Report - {{ selectedEmployee?.members }}</h2>
    <p><strong>Payroll Month:</strong> {{ selectedMonthLabel }}</p>
    <div class="coming-soon">Detailed view coming soon...</div>
  </div>
</div>